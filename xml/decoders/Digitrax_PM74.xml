<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../XSLT/decoder.xsl"?>
<decoder-config xmlns:xi="http://www.w3.org/2001/XInclude"
                xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                xsi:noNamespaceSchemaLocation="http://jmri.org/xml/schema/decoder-4-15-2.xsd"
                showEmptyPanes="no"
                suppressFunctionLabels="yes"
                suppressRosterMedia="yes"
                >

    <version author="Bob Jacobsen" version="1" lastUpdated="20230410" />
    <version author="Bob Jacobsen and Bob Milhaupt" version="2" lastUpdated="20230925" />

    <decoder>

        <family name="Series 7 Accessory Devices" mfg="Digitrax">
            <model model="PM74"/>
        </family>

        <programming direct="no" paged="yes" register="no" ops="no"><!-- paged yes allows initial setup and change of address -->
            <mode>LOCONETBD7OPSWMODE</mode>
        </programming>

        <variables>
          <!-- Needed to set the "Base Address" value. May be set when creating 
            the initial roster entry.  May not be modified after creation! -->
          <variable CV="1,2" comment="Base address" item="Long Address" default="1" infoOnly="yes">
            <splitVal highCV="2" min="1" max="2045"/>
            <label>Base Address</label>
          </variable>

          <variable CV="7" item="Decoder Version" readOnly="yes" default="74">
            <decVal/>
            <label>Version ID</label>
            <label xml:lang="it">Versione Decoder: </label>
            <label xml:lang="fr">Version d√©codeur: </label>
            <label xml:lang="de">Decoder Version: </label>
          </variable>
          <variable CV="8" readOnly="yes" item="Manufacturer" default="129">
            <decVal/>
            <label>Manufacturer ID</label>
            <label xml:lang="it">ID Costruttore: </label>
            <label xml:lang="fr">ID constructeur: </label>
            <label xml:lang="de">Hersteller ID: </label>
          </variable>

          <variable item="Serial Number" CV="9,10" readOnly="yes">
            <splitVal highCV="10"/>
            <label>Serial Number</label>
          </variable>

          <variable CV="11" item="DS1 mode" default="0"
                tooltip="OpSw1" mask="XXXXXXXV"><!-- opsw 1 -->
            <enumVal>
              <enumChoice>
                <choice>over-current</choice>
              </enumChoice>
              <enumChoice>
                <choice>auto-reverse</choice>
              </enumChoice>
            </enumVal>
            <label>DS1 mode: </label>
          </variable>

          <variable CV="11" item="DS2 mode" default="0"
                tooltip="OpSw2" mask="XXXXXXVX"><!-- opsw 2 -->
            <enumVal>
              <enumChoice>
                <choice>over-current</choice>
              </enumChoice>
              <enumChoice>
                <choice>auto-reverse</choice>
              </enumChoice>
            </enumVal>
            <label>DS2 mode: </label>
          </variable>

          <variable CV="11" item="DS3 mode" default="0"
                tooltip="OpSw3" mask="XXXXXVXX"><!-- opsw 3 -->
            <enumVal>
              <enumChoice>
                <choice>over-current</choice>
              </enumChoice>
              <enumChoice>
                <choice>auto-reverse</choice>
              </enumChoice>
            </enumVal>
            <label>DS3 mode: </label>
          </variable>

          <variable CV="11" item="DS4 mode" default="0"
                tooltip="OpSw4" mask="XXXXVXXX"><!-- opsw 4 -->
            <enumVal>
              <enumChoice>
                <choice>over-current</choice>
              </enumChoice>
              <enumChoice>
                <choice>auto-reverse</choice>
              </enumChoice>
            </enumVal>
            <label>DS4 mode: </label>
          </variable>

          <variable CV="11" item="Trip current" default="0"
                tooltip="OpSw7-8" mask="VVXXXXXX"><!-- opsw 7-8 -->
            <enumVal>
              <enumChoice><!-- 00 -->
                <choice>normal - 4 Amps</choice>
              </enumChoice>
              <enumChoice><!-- 01 -->
                <choice>lower - 3 Amps</choice>
              </enumChoice>
              <enumChoice><!-- 10 -->
                <choice>higher - 6 Amps</choice>
              </enumChoice>
            </enumVal>
            <label>Trip current: </label>
          </variable>

          <variable CV="12" item="Occupancy" default="0"
                tooltip="OpSw11" mask="XXXXXVXX"><!-- opsw 11 -->
            <enumVal>
              <enumChoice>
                <choice>enabled</choice>
              </enumChoice>
              <enumChoice>
                <choice>disabled</choice>
              </enumChoice>
            </enumVal>
            <label>Occupancy detection: </label>
          </variable>

          <variable CV="12" item="Transponding" default="0"
                tooltip="OpSw12" mask="XXXXVXXX"><!-- opsw 12 -->
            <enumVal>
              <enumChoice>
                <choice>enabled</choice>
              </enumChoice>
              <enumChoice>
                <choice>disabled</choice>
              </enumChoice>
            </enumVal>
            <label>Transponding detection: </label>
          </variable>

          <variable CV="12" item="LocoNet Power Reporting" default="0"
                tooltip="OpSw13" mask="XXXVXXXX"><!-- opsw 12 -->
            <enumVal>
              <enumChoice>
                <choice>enabled</choice>
              </enumChoice>
              <enumChoice>
                <choice>disabled</choice>
              </enumChoice>
            </enumVal>
            <label>LocoNet Reporting of Power Status: </label>
          </variable>
          
          <variable CV="13" item="CV 13" default="0" infoOnly="yes"
                tooltip="OpSw17-24" mask="VVVVVVVV">
            <decVal min="0" max="255" />
            <label>CV 13: </label>
          </variable>

          <variable CV="14" item="Sensitivity" default="0"
                tooltip="OpSw31" mask="XVXXXXXX"><!-- opsw 31 -->
            <enumVal>
              <enumChoice>
                <choice>normal</choice>
              </enumChoice>
              <enumChoice>
                <choice>increased</choice>
              </enumChoice>
            </enumVal>
            <label>Occupancy Sensitivity: </label>
          </variable>

          <variable CV="15" item="CV 15" default="0" infoOnly="yes"
                tooltip="OpSw33-40" mask="VVVVVVVV">
            <decVal min="0" max="255" />
            <label>CV 15: </label>
          </variable>

          <variable CV="16" item="LEDs" default="0"
                tooltip="OpSw41" mask="XXXXXXXV"><!-- opsw 41 -->
            <enumVal>
              <enumChoice>
                <choice>detection</choice>
              </enumChoice>
              <enumChoice>
                <choice>relay state</choice>
              </enumChoice>
            </enumVal>
            <label>LEDs show: </label>
          </variable>

        </variables>
        <resets>
            <mode>LOCONETBD7OPSWMODE</mode>
            <factReset label="Restart Board" CV="8" default="0">
                <label>Restart Board</label>
            </factReset>
            <factReset label="Factory Reset" CV="15" default="128">
                <label>Reset All CVs</label>
            </factReset>
        </resets>
    </decoder>
  <pane xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://jmri.org/xml/schema/programmer.xsd">
    <name>CVs</name>
    <column>
        <row>
            <label>
                <text>&lt;html&gt;&lt;span style=&quot;color: black;&quot;&gt;&lt;h1&gt;&lt;strong&gt;PM74 OpSw Settings&lt;/strong&gt;&lt;/h2&gt;&lt;/html&gt;</text>
            </label>
        </row>
        <row>
            <cvtable/>
        </row>
        <row>
            <column>
                <label>
                    <text>&lt;html&gt;Notes:&lt;ul&gt;
                        &lt;li&gt;The "CV" column in the table above shows CV numbers, not the Op Switch number.  To 
                        &lt;br&gt;see those, hover your mouse over a variable on the 'Configuration' pane.
                        &lt;li&gt;CVs 1 and 2 reflect the Board Address configured on the "Basic" sheet as a 11 bit value,
                        &lt;br&gt;with the lowest 8 bits in CV 1 and the remaining 3 bits in CV 2 as its least-significant bits.
                    </text>
                </label>
                <label>
                    <text> </text>
                </label>
            </column>
        </row>
    </column>

  </pane>
  <pane>
      <name>Basic</name>
      <column>
            <label>
                <text>&lt;html&gt;&lt;span style=&quot;color: black;&quot;&gt;&lt;h1&gt;&lt;strong&gt;PM74 OpSw Settings&lt;/strong&gt;&lt;/h2&gt;&lt;/html&gt;</text>
            </label>
          <display item="Long Address"/>
          <label>
              <text> </text>
          </label>
          <label>
            <text>&lt;html&gt;&lt;p&gt;
                &lt;p&gt;Note that some Digitrax documentation refers
                to Board Address, while other documentation refers to
                &lt;p&gt;Board ID.  These are equivalent concepts.
                &lt;p&gt;This roster entry will only access the specified
                board if the Board Address (i.e. Board ID), specified above,
                &lt;br&gt;was correctly entered when the roster entry was first created.
                You cannot change it here.
            &lt;/html&gt;</text>
          </label>

          <label>
              <text> </text>
          </label>

          <display item="Serial Number"/>

      </column>
  </pane>

    <pane>
        <name>Configuration</name>
        <column>
            <label>
                <text>&lt;html&gt;&lt;span style=&quot;color: black;&quot;&gt;&lt;h1&gt;&lt;strong&gt;PM74 Configuration Settings&lt;/strong&gt;&lt;/h2&gt;&lt;/html&gt;</text>
            </label>
            <label><text>&lt;html&gt;&lt;span style=&quot;color: black;&quot;&gt;&lt;h2&gt;&lt;strong&gt;Outputs Modes&lt;/strong&gt;&lt;/h2&gt;&lt;/html&gt;</text></label>
            <row>
                <column><display item="DS1 mode"/></column>
                <column><label><text>          </text></label></column>
                <column><display item="DS3 mode"/></column>
            </row>
            <row>
                <column><display item="DS2 mode"/></column>
                <column><label><text>          </text></label></column>
                <column><display item="DS4 mode"/></column>
            </row>
            <label><text>&lt;html&gt;&lt;span style=&quot;color: black;&quot;&gt;&lt;h2&gt;&lt;strong&gt;Power Characteristics&lt;/strong&gt;&lt;/h2&gt;&lt;/html&gt;</text></label>
            <display item="Trip current"/>
            <label><text>&lt;html&gt;&lt;span style=&quot;color: black;&quot;&gt;&lt;h2&gt;&lt;strong&gt;Occupancy and Transponding Characteristics&lt;/strong&gt;&lt;/h2&gt;&lt;/html&gt;</text></label>
            <display item="LocoNet Power Reporting"/>
            <label>
                <text>&lt;html&gt;The PM74 &lt;em&gt;always&lt;/em&gt; performs over-currect and/or auto-reverse detection, but 
                    &lt;p&gt;it may or may not report it via LocoNet depending on this configuration setting.</text>
            </label>
            <label><text> </text></label>
            <display item="Sensitivity"/>
            <display item="Occupancy"/>
            <label>
                <text>&lt;html&gt;The PM74 may be configured to disable occupancy detection - both LocoNet reporting and LED display.</text>
            </label>
            <label><text> </text></label>
            <display item="Transponding"/>
            <label>
                <text>&lt;html&gt;The PM74 may be configured to disable transponding - both LocoNet reporting and LED display.</text>
            </label>
            <label><text> </text></label>
            <label><text>&lt;html&gt;&lt;span style=&quot;color: black;&quot;&gt;&lt;h2&gt;&lt;strong&gt;Miscellaneous&lt;/strong&gt;&lt;/h2&gt;&lt;/html&gt;</text></label>
            <display item="LEDs"/>
        </column>
    </pane>

    <pane>
      <name>Notes</name>
      <column>
        <label><text>&lt;html&gt;&lt;span style=&quot;color: black;&quot;&gt;
            &lt;h2&gt;&lt;strong&gt;Notes on PM74 Roster Entries and Programming
            &lt;/strong&gt;&lt;/h2&gt;&lt;/html&gt;</text>
        </label>
        <label>
            <text>&lt;html&gt;&lt;/strong&gt;&lt;ul&gt;
                &lt;li&gt;
                This roster entry uses the "Extended Accessory Decoder CV" method 
                &lt;p&gt;to access the PM74's "OpSw"s.  This is effectively the same as 
                &lt;p&gt;is described in the PM74 instruction in the "Programming DS74 CVs"
                &lt;p&gt;section.
                &lt;/li&gt;
                &lt;li&gt;
                The PM74 Roster entry has no ability to change the entry's "Base Address".
                &lt;p&gt;Use the mechanisms shown in the PM74's Manual for Digitrax' suggestions
                &lt;p&gt;for changing the Base Address.
                &lt;/li&gt;
                &lt;li&gt;
                Use care when defining the PM74's "Base Address".  The PM74 defines its Base 
                &lt;p&gt;Address to be the device's single "Power" address.  All of its other addresses 
                &lt;p&gt;are defined based on the number of addresses implemented by the PM74.
                &lt;/li&gt;
                &lt;li&gt;
                The PM74's Reporter functionality does not work for all "Base Address" 
                &lt;p&gt;values (at least for some PM74 firmware versions!).  Be aware that "Base Address"es 
                &lt;p&gt;between 129 and 253 do not map, at all, to reporters, and "Base Address"es   
                &lt;p&gt;between 126 and 128, and between 254 thru 256, do no map all four of the
                &lt;p&gt;detection sections to Reporters.  The same happpens between 385 and 512, 
                &lt;p&gt;between 641 and 768, between 897 and 1024, between 1153 and 1280, between
                &lt;p&gt;1409 and 1536, between 1665 and 1792, and between 1921 and 2048.
                &lt;/li&gt;
            </text>
        </label>
      </column>
  </pane>
</decoder-config>
